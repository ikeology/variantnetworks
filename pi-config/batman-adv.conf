# üõ∞Ô∏è Raspberry Pi BATMAN-adv Mesh Setup

This file documents how to install and activate the BATMAN-adv mesh script (`mesh-setup.sh`) on a Raspberry Pi, and includes debugging steps to ensure `NetworkManager` does not interfere with mesh functionality.

---

## üîÅ Step-by-Step: Deploy `mesh-setup.sh`

### 1. Prepare the Raspberry Pi

- Flash Raspberry Pi OS Lite (64-bit recommended)
- Enable SSH: place an empty file named `ssh` in the boot partition
- Boot and SSH into the Pi

---

### 2. Install Dependencies

```bash
sudo apt update
sudo apt install -y batctl iw wireless-tools net-tools libnl-3-dev libnl-genl-3-dev

#3. Create the Mesh Script
nano mesh-setup.sh

#!/bin/bash
sudo modprobe batman-adv

# Set up wlan0 in ad-hoc mode
sudo ip link set wlan0 down
sudo iwconfig wlan0 mode ad-hoc
sudo iwconfig wlan0 essid my-mesh-network
sudo iwconfig wlan0 ap 02:12:34:56:78:XX  # Change XX per device
sudo iwconfig wlan0 channel 8

# Optional: skip MTU due to Pi 5 compatibility issues
# sudo ifconfig wlan0 mtu 1532

sleep 1
sudo ip link set wlan0 up

# Add to batman-adv
sudo batctl if add wlan0
sleep 1
sudo ip link set bat0 up

# Assign unique static IP
sudo ifconfig bat0 172.27.0.XX/16  # Change XX per device

#Then make it executable:
chmod +x mesh-setup.sh


NetworkManager Conflicts
1. Prevent NetworkManager from Managing wlan0
sudo nano /etc/NetworkManager/conf.d/99-unmanaged-wlan0.conf

Paste:
[keyfile]
unmanaged-devices=interface-name:wlan0

restart NetworkManager:
sudo systemctl restart NetworkManager
nmcli device status

‚úÖ Confirm wlan0 shows as unmanaged.

sudo pkill wpa_supplicant


‚úÖ Validation Checklist
WLAN in Ad-Hoc Mode:
iwconfig
# Should show: Mode:Ad-Hoc ESSID:"my-mesh-network"
BATMAN-adv Interface Active:
batctl if
# Should show: wlan0: active
IP Address Assigned to bat0:
ifconfig bat0
# Should show: inet 172.27.0.XX


üåê Mesh Test
With multiple Pis online:

View Mesh Peers:
sudo batctl o
Ping Another Node:
ping 172.27.0.YY



#üìå Notes
- Replace XX in MAC and IP addresses for each device.
- Use IPs in the range 172.27.0.0/16
- Ad-hoc mode may not work with all USB Wi-Fi adapters ‚Äî Atheros is recommended.
- MTU tuning is optional and may fail on Pi 5. ###